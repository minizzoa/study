<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üïπÔ∏è Ï†àÎåÄÏùåÍ∞ê ÌÖåÏä§Ìä∏</title>
    <style>
        :root {
            --bg-color: #1a1a2e;
            --panel-color: #16213e;
            --accent-color: #f1c40f;
            --correct: #2ecc71;
            --wrong: #e74c3c;
            --text-color: #fff;
        }

        body {
            font-family: -apple-system, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            margin: 0;
            padding-top: 10px;
            overflow: hidden;
        }

        .container {
            background: var(--panel-color);
            padding: 15px;
            border-radius: 20px;
            width: 92%;
            max-width: 360px;
            text-align: center;
            border: 3px solid #0f3460;
            position: relative;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 25px rgba(0,0,0,0.4);
        }

        .main-title {
            font-size: 1.3rem;
            font-weight: 900;
            margin-bottom: 10px;
            color: var(--accent-color);
            text-shadow: 2px 2px #000;
        }

        .header { 
            display: flex; 
            justify-content: space-between; 
            margin-bottom: 8px; 
            font-weight: bold; 
            font-size: 0.85rem; 
            background: rgba(0,0,0,0.2);
            padding: 5px 10px;
            border-radius: 8px;
        }
        .score-box { color: var(--accent-color); }
        .lives-box { color: var(--wrong); letter-spacing: 1px; }

        .level-info { margin-bottom: 2px; color: #00d2ff; font-weight: bold; font-size: 1rem; }
        .step-info { font-size: 0.75rem; margin-bottom: 10px; color: #888; }

        .display {
            background: #000;
            height: 90px;
            border-radius: 12px;
            margin-bottom: 12px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border: 2px solid var(--accent-color);
        }

        .btn-group {
            display: flex;
            gap: 10px;
        }

        .btn-play {
            background: var(--accent-color);
            border: none;
            padding: 10px 20px;
            font-size: 0.9rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 0 #b7950b;
        }
        
        .btn-re {
            background: #9b59b6;
            color: white;
            box-shadow: 0 4px 0 #8e44ad;
        }

        .btn-play:active { transform: translateY(2px); box-shadow: 0 2px 0 #b7950b; }
        .btn-re:active { box-shadow: 0 2px 0 #8e44ad; }

        .piano {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 6px;
        }
        .key {
            background: #fff; color: #333; border: none; padding: 14px 0;
            border-radius: 8px; font-weight: bold; font-size: 0.95rem; cursor: pointer;
            box-shadow: 0 3px 0 #ccc;
        }
        .key.black { background: #333; color: #fff; box-shadow: 0 3px 0 #000; }
        .key:active { transform: translateY(2px); box-shadow: none; }

        #overlay {
            display: none;
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(22, 33, 62, 0.98);
            border-radius: 17px;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        .result-title { font-size: 1.8rem; margin-bottom: 8px; font-weight: 900; }
        .result-score { font-size: 1.3rem; margin-bottom: 20px; }
        
        .confetti { position: absolute; width: 6px; height: 6px; animation: fall 2.5s linear forwards; }
        @keyframes fall { to { transform: translateY(450px) rotate(360deg); opacity: 0; } }
    </style>
</head>
<body>

<div class="container" id="gameContainer">
    <div class="main-title">üéµ Ï†àÎåÄÏùåÍ∞ê ÌÖåÏä§Ìä∏</div>

    <div id="gamePlayView">
        <div class="header">
            <div class="score-box">SCORE: <span id="scoreVal">0</span></div>
            <div class="lives-box"><span id="lifeVal">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></div>
        </div>
        
        <div class="level-info" id="levelTxt">LEVEL 1</div>
        <div class="step-info" id="progressTxt">Step 1 / 3</div>

        <div class="display">
            <div class="btn-group">
                <button class="btn-play" id="playBtn">START üîä</button>
                <button class="btn-play btn-re" id="reBtn" style="display: none;">üîÑ RE-LISTEN</button>
            </div>
            <div id="inputStatus" style="margin-top: 8px; font-size: 0.75rem; color: #00ff41; font-weight: bold;">READY</div>
        </div>

        <div class="piano">
            <button class="key" data-note="0">C</button>
            <button class="key black" data-note="1">C#</button>
            <button class="key" data-note="2">D</button>
            <button class="key black" data-note="3">D#</button>
            <button class="key" data-note="4">E</button>
            <button class="key" data-note="5">F</button>
            <button class="key black" data-note="6">F#</button>
            <button class="key" data-note="7">G</button>
            <button class="key black" data-note="8">G#</button>
            <button class="key" data-note="9">A</button>
            <button class="key black" data-note="10">A#</button>
            <button class="key" data-note="11">B</button>
        </div>
    </div>

    <div id="overlay">
        <div class="result-title" id="resTitle">CLEAR!</div>
        <div class="result-score" id="resScore">SCORE: 000</div>
        <button class="btn-play" onclick="resetGame()">PLAY AGAIN</button>
    </div>
</div>

<script>
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const notes = [
        { name: "C", freq: 261.63 }, { name: "C#", freq: 277.18 },
        { name: "D", freq: 293.66 }, { name: "D#", freq: 311.13 },
        { name: "E", freq: 329.63 }, { name: "F", freq: 349.23 },
        { name: "F#", freq: 369.99 }, { name: "G", freq: 392.00 },
        { name: "G#", freq: 415.30 }, { name: "A", freq: 440.00 },
        { name: "A#", freq: 466.16 }, { name: "B", freq: 493.88 }
    ];

    let state = {
        level: 1, step: 1, score: 0, lives: 5,
        targetNotes: [], userInputs: [],
        isPlaying: false,
        config: {
            stepsPerLevel: [0, 3, 2, 2],
            notesPerLevel: [0, 1, 2, 3]
        }
    };

    // ÏÜåÎ¶¨ Ï∂úÎ†• Ìï®Ïàò (Ïã§Ìå® Ïãú Î≥ºÎ•® Ï°∞Ï†à Í∞ÄÎä•ÌïòÎèÑÎ°ù ÏàòÏ†ï)
    function playSound(freq, duration = 0.5, type = 'triangle', vol = 0.15) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(vol, audioCtx.currentTime); // Î≥ºÎ•® Îß§Í∞úÎ≥ÄÏàò Ï†ÅÏö©
        gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + duration);
    }

    async function playSequence() {
        if (state.isPlaying) return;
        state.isPlaying = true;
        updateStatus("LISTENING...");

        for (const idx of state.targetNotes) {
            playSound(notes[idx].freq);
            await new Promise(r => setTimeout(r, 700));
        }
        state.isPlaying = false;
        updateStatus(state.userInputs.length > 0 ? `INPUT: ${state.userInputs.length} / ${state.targetNotes.length}` : "YOUR TURN!");
    }

    function nextStep() {
        state.userInputs = [];
        const count = state.config.notesPerLevel[state.level];
        state.targetNotes = Array.from({length: count}, () => Math.floor(Math.random() * 12));
        
        document.getElementById('levelTxt').textContent = `LEVEL ${state.level}`;
        document.getElementById('progressTxt').textContent = `Step ${state.step} / ${state.config.stepsPerLevel[state.level]}`;
        
        document.getElementById('playBtn').style.display = 'none';
        document.getElementById('reBtn').style.display = 'block';
        
        playSequence();
    }

    function handleInput(idx) {
        if (state.isPlaying || state.lives <= 0 || state.targetNotes.length === 0) return;
        
        playSound(notes[idx].freq, 0.3);
        state.userInputs.push(parseInt(idx));
        updateStatus(`INPUT: ${state.userInputs.length} / ${state.targetNotes.length}`);

        if (state.userInputs.length === state.targetNotes.length) {
            validate();
        }
    }

    function validate() {
        const correct = JSON.stringify(state.userInputs) === JSON.stringify(state.targetNotes);
        
        if (correct) {
            state.score += (state.level * 20);
            document.getElementById('scoreVal').textContent = state.score;
            visualFeedback('var(--correct)');
            
            state.step++;
            if (state.step > state.config.stepsPerLevel[state.level]) {
                state.level++;
                state.step = 1;
            }

            if (state.level > 3) finishGame(true);
            else setTimeout(nextStep, 800);
        } else {
            state.lives--;
            document.getElementById('lifeVal').textContent = "‚ù§Ô∏è".repeat(state.lives);
            visualFeedback('var(--wrong)');
            if (state.lives <= 0) finishGame(false);
            else {
                state.userInputs = [];
                updateStatus("WRONG! TRY AGAIN");
            }
        }
    }

    function finishGame(success) {
        const overlay = document.getElementById('overlay');
        const title = document.getElementById('resTitle');
        const scoreDisp = document.getElementById('resScore');
        
        overlay.style.display = 'flex';
        scoreDisp.textContent = `FINAL SCORE: ${state.score}`;
        
        if (success) {
            title.textContent = "üéâ CLEAR!";
            title.style.color = "var(--correct)";
            [523, 659, 783, 1046].forEach((f, i) => setTimeout(() => playSound(f, 0.6, 'sine', 0.15), i * 150));
            spawnConfetti();
        } else {
            title.textContent = "üíÄ GAME OVER";
            title.style.color = "var(--wrong)";
            // Ïã§Ìå® ÏÇ¨Ïö¥Îìú Î≥ºÎ•®ÏùÑ 0.05(Í∏∞Ï°¥Ïùò ÏïΩ 1/3)Î°ú ÎåÄÌè≠ Ï∂ïÏÜåÌïòÍ≥† ÌååÌòïÏùÑ Î∂ÄÎìúÎü¨Ïö¥ triangleÎ°ú Î≥ÄÍ≤Ω
            playSound(110, 0.6, 'triangle', 0.05);
        }
    }

    function spawnConfetti() {
        for (let i = 0; i < 30; i++) {
            const c = document.createElement('div');
            c.className = 'confetti';
            c.style.left = Math.random() * 100 + '%';
            c.style.top = '-10px';
            c.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
            c.style.animationDuration = (Math.random() * 2 + 1) + 's';
            document.getElementById('overlay').appendChild(c);
        }
    }

    function resetGame() {
        state = { ...state, level: 1, step: 1, score: 0, lives: 5, targetNotes: [], userInputs: [] };
        document.getElementById('scoreVal').textContent = "0";
        document.getElementById('lifeVal').textContent = "‚ù§Ô∏è".repeat(5);
        document.getElementById('overlay').style.display = 'none';
        document.getElementById('playBtn').style.display = 'block';
        document.getElementById('reBtn').style.display = 'none';
        document.querySelectorAll('.confetti').forEach(c => c.remove());
        updateStatus("READY");
    }

    function updateStatus(msg) { document.getElementById('inputStatus').textContent = msg; }
    function visualFeedback(color) {
        const container = document.getElementById('gameContainer');
        container.style.borderColor = color;
        setTimeout(() => container.style.borderColor = '#0f3460', 300);
    }

    document.querySelectorAll('.key').forEach(k => k.addEventListener('click', () => handleInput(k.dataset.note)));
    
    document.getElementById('playBtn').addEventListener('click', () => {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        nextStep();
    });

    document.getElementById('reBtn').addEventListener('click', () => {
        playSequence();
    });
</script>
</body>
</html>