<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ë‚ ì•„ë¼ ì‚ì•½ì´! âœ¨</title>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <style>
        :root {
            --sky: #87CEEB;
            --btn-main: #ff8b94;
        }
        body { 
            margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; 
            background: #fdf6e3; font-family: 'Jua', sans-serif; overflow: hidden;
            touch-action: none; -webkit-user-select: none; user-select: none;
        }

        h1 { margin: 10px 0 5px 0; color: #ff8b94; font-size: 1.8rem; }

        .status-bar {
            width: 95vw; max-width: 380px; display: flex; justify-content: space-between; 
            align-items: center; margin-bottom: 10px; background: white; 
            padding: 8px 12px; border-radius: 12px; box-sizing: border-box; box-shadow: 0 4px #eee;
        }
        .score-info { font-size: 1.1rem; color: #5d544b; display: flex; align-items: center; gap: 8px; }
        #level-tag { font-size: 0.8rem; background: #ffeb3b; padding: 2px 8px; border-radius: 10px; }

        .controls { display: flex; gap: 5px; }
        button {
            padding: 8px 10px; border: none; border-radius: 8px; font-family: 'Jua';
            font-size: 0.9rem; cursor: pointer; color: white; display: flex; align-items: center; justify-content: center;
        }
        .btn-pause { background: #feb236; }
        .btn-restart { background: #ff7b25; }
        .btn-mute { background: #a8a8a8; width: 40px; font-size: 1.1rem; }
        .btn-mute.active { background: #ff8b94; }

        #game-container { position: relative; width: 90vw; height: 65vh; max-width: 360px; max-height: 500px; }
        canvas { 
            background: var(--sky); border-radius: 15px; width: 100%; height: 100%;
            display: block; box-shadow: 0 5px 15px rgba(0,0,0,0.1); transition: background 1.5s;
        }

        #overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.85); display: none;
            flex-direction: column; align-items: center; justify-content: center;
            border-radius: 15px; z-index: 10;
        }
        
        .guide-text { margin-top: 10px; color: #888; font-size: 0.9rem; text-align: center; }
    </style>
</head>
<body>

    <h1>ğŸ¤ ë‚ ì•„ë¼ ì‚ì•½ì´! ğŸš€</h1>

    <div class="status-bar">
        <div class="score-info">
            <span>ì ìˆ˜: <b id="score">0</b></span>
            <span id="level-tag">ì´ˆë³´ ì‚ì•½ì´</span>
        </div>
        <div class="controls">
            <button class="btn-mute" id="muteBtn" onclick="toggleMute(event)">ğŸ”Š</button>
            <button class="btn-pause" onclick="togglePause(event)" id="pauseBtn">ì¤‘ì§€</button>
            <button class="btn-restart" onclick="resetGame(event)">ë‹¤ì‹œ ì‹œì‘</button>
        </div>
    </div>

    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
        <div id="overlay">
            <h2 id="end-title" style="font-size: 2rem; color: #ff8b94; margin: 0;">ì‚ì•½... í„¸ì©!</h2>
            <p id="finalScore" style="font-size: 1.2rem; margin: 10px 0;"></p>
            <button class="btn-restart" onclick="resetGame(event)" style="padding: 12px 25px; font-size: 1.2rem; background: var(--btn-main); width: auto;">ë‹¤ì‹œ ë„ì „!</button>
        </div>
    </div>
    
    <p class="guide-text">í™”ë©´ì„ í„°ì¹˜í•´ì„œ ì‚ì•½ì´ë¥¼ ë†’ì´ ë„ìš°ì„¸ìš”!<br>(ì´ˆë°˜ì—ëŠ” ê¸°ë‘¥ ì‚¬ì´ê°€ ì•„ì£¼ ë„“ì–´ìš” ğŸ˜Š)</p>

    <img src="chick_flying.png" id="birdImage" style="display:none;">

    <audio id="jumpSound" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3" preload="auto"></audio>
    <audio id="scoreSound" src="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3" preload="auto"></audio>
    <audio id="hitSound" src="https://assets.mixkit.co/active_storage/sfx/2533/2533-preview.mp3" preload="auto"></audio>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const pauseBtn = document.getElementById("pauseBtn");
        const muteBtn = document.getElementById("muteBtn");
        const overlay = document.getElementById("overlay");
        const levelTag = document.getElementById("level-tag");
        const birdImage = document.getElementById("birdImage"); // ì´ë¯¸ì§€ ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
        
        const CW = 360, CH = 500;
        canvas.width = CW; canvas.height = CH;

        let bird, pipes, score, frames, gameActive, isPaused, isMuted = false;
        
        let pipeSpeed, pipeGap, spawnInterval;

        // ì´ë¯¸ì§€ê°€ ë¡œë“œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼
        birdImage.onload = () => {
            resetGame();
        };
        // ë§Œì•½ ì´ë¯¸ì§€ê°€ ë°”ë¡œ ë¡œë“œë˜ì§€ ì•ŠëŠ”ë‹¤ë©´ (ìºì‹œ ë“±ìœ¼ë¡œ) ê°•ì œ í˜¸ì¶œ
        if (birdImage.complete) {
            resetGame();
        }


        function playSfx(id) {
            if (isMuted) return;
            const sound = document.getElementById(id);
            sound.currentTime = 0;
            sound.play().catch(() => {});
        }

        function toggleMute(e) {
            e.stopPropagation();
            isMuted = !isMuted;
            muteBtn.innerText = isMuted ? "ğŸ”‡" : "ğŸ”Š";
            muteBtn.classList.toggle('active', isMuted);
        }

        class Bird {
            constructor() {
                this.x = 60; this.y = CH / 2; this.v = 0;
                this.gravity = 0.22; this.jumpPower = -4.8; 
                this.width = 40; // ì´ë¯¸ì§€ í¬ê¸°ì— ë§ì¶° ì¡°ì ˆ
                this.height = 40; // ì´ë¯¸ì§€ í¬ê¸°ì— ë§ì¶° ì¡°ì ˆ
            }
            draw() {
                // ì´ë¯¸ì§€ê°€ ë¡œë“œë˜ì—ˆì„ ë•Œë§Œ ê·¸ë¦¬ê¸°
                if (birdImage.complete && birdImage.naturalWidth !== 0) {
                    ctx.save();
                    ctx.translate(this.x, this.y);
                    ctx.rotate(Math.min(Math.PI / 4, Math.max(-Math.PI / 4, this.v * 0.1)));
                    // ì´ë¯¸ì§€ ì¤‘ì‹¬ì„ ê¸°ì¤€ìœ¼ë¡œ ê·¸ë¦¬ê¸° ìœ„í•´ ìœ„ì¹˜ ì¡°ì •
                    ctx.drawImage(birdImage, -this.width / 2, -this.height / 2, this.width, this.height);
                    ctx.restore();
                } else {
                    // ì´ë¯¸ì§€ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ë‹¤ë©´ ê¸°ì¡´ì²˜ëŸ¼ ì›ìœ¼ë¡œ ê·¸ë¦¼ (ì„ì‹œ)
                    ctx.beginPath(); ctx.arc(this.x, this.y, 16, 0, Math.PI * 2);
                    ctx.fillStyle = "#FFEB3B"; ctx.fill();
                    ctx.strokeStyle = "#FBC02D"; ctx.lineWidth = 3; ctx.stroke();
                }
            }
            update() {
                if (isPaused) return;
                this.v += this.gravity;
                this.y += this.v;
                // ë°”ë‹¥ ë˜ëŠ” ì²œì¥ ì¶©ëŒ ì‹œ ê²Œì„ ì˜¤ë²„
                if (this.y + this.height / 2 > CH || this.y - this.height / 2 < 0) endGame();
            }
            jump() {
                if (isPaused || !gameActive) return;
                this.v = this.jumpPower;
                playSfx('jumpSound');
            }
        }

        function updateDifficulty() {
            if (score < 5) {
                pipeSpeed = 1.8; 
                pipeGap = 180; 
                spawnInterval = 120;
                levelTag.innerText = "ì´ˆë³´ ì‚ì•½ì´";
                levelTag.style.background = "#fff";
                levelTag.style.color = "#5d544b";
            } else if (score < 15) {
                pipeSpeed = 2.2 + (score - 5) * 0.1;
                pipeGap = 180 - (score - 5) * 3;
                spawnInterval = 110 - (score - 5) * 2;
                levelTag.innerText = "ì¤‘ìˆ˜ ì‚ì•½ì´";
                levelTag.style.background = "#ffeb3b";
                levelTag.style.color = "#5d544b";
            } else {
                pipeSpeed = Math.min(3.2 + (score - 15) * 0.05, 5.0);
                pipeGap = Math.max(150 - (score - 15) * 2, 110);
                spawnInterval = Math.max(90 - (score - 15) * 1, 65);
                levelTag.innerText = "ê³ ìˆ˜ ì‚ì•½ì´ ğŸ”¥";
                levelTag.style.background = "#ff8b94";
                levelTag.style.color = "white";
            }
            
            if (score >= 5) {
                const hue = Math.max(200 - score * 2, 150);
                canvas.style.background = `hsl(${hue}, 70%, 75%)`;
            } else {
                 canvas.style.background = "var(--sky)"; // ì´ˆê¸° ë°°ê²½ìƒ‰ ìœ ì§€
            }
        }

        function spawnPipe() {
            const minH = 60;
            const top = Math.random() * (CH - pipeGap - minH * 2) + minH;
            pipes.push({ x: CW, top: top, gap: pipeGap, passed: false });
        }

        function togglePause(e) {
            e.stopPropagation();
            if (!gameActive) return;
            isPaused = !isPaused;
            pauseBtn.innerText = isPaused ? "ê³„ì†" : "ì¤‘ì§€";
            pauseBtn.style.background = isPaused ? "#4caf50" : "#feb236";
            if (!isPaused) requestAnimationFrame(loop);
        }

        function resetGame(e) {
            if(e) e.stopPropagation();
            bird = new Bird();
            pipes = []; score = 0; frames = 0;
            gameActive = true; isPaused = false;
            canvas.style.background = "var(--sky)";
            overlay.style.display = "none";
            updateDifficulty(); // ë‚œì´ë„ ì´ˆê¸°í™”
            document.getElementById("score").innerText = "0";
            requestAnimationFrame(loop);
        }

        function endGame() {
            gameActive = false;
            playSfx('hitSound');
            document.getElementById("finalScore").innerText = `${score}ì  ë‹¬ì„±!`;
            overlay.style.display = "flex";
        }

        function loop() {
            if (!gameActive || isPaused) return;

            ctx.clearRect(0, 0, CW, CH);
            updateDifficulty();

            if (frames % Math.floor(spawnInterval) === 0) spawnPipe();
            
            pipes.forEach((p, i) => {
                p.x -= pipeSpeed;
                ctx.fillStyle = "#8BC34A";
                ctx.fillRect(p.x, 0, 50, p.top);
                ctx.fillRect(p.x, p.top + p.gap, 50, CH);
                
                ctx.strokeStyle = "#558B2F"; ctx.lineWidth = 2;
                ctx.strokeRect(p.x, 0, 50, p.top);
                ctx.strokeRect(p.x, p.top + p.gap, 50, CH);
                
                // [ì¶©ëŒ ê°ì§€ ë¡œì§ ìˆ˜ì •]: ì´ë¯¸ì§€ í¬ê¸° ë°˜ì˜
                if (bird.x + bird.width / 2 > p.x && bird.x - bird.width / 2 < p.x + 50) {
                    if (bird.y - bird.height / 2 < p.top || bird.y + bird.height / 2 > p.top + p.gap) endGame();
                }

                if (p.x + 50 < bird.x - bird.width/2 && !p.passed) { // ì ìˆ˜ íšë“ ì¡°ê±´ë„ ì´ë¯¸ì§€ ê¸°ì¤€
                    score++;
                    p.passed = true;
                    document.getElementById("score").innerText = score;
                    playSfx('scoreSound');
                }
                if (p.x < -50) pipes.splice(i, 1);
            });

            bird.update();
            bird.draw();
            frames++;
            requestAnimationFrame(loop);
        }

        window.addEventListener("touchstart", (e) => {
            if(e.target.tagName === 'BUTTON') return;
            e.preventDefault(); bird.jump();
        }, { passive: false });
        window.addEventListener("mousedown", (e) => {
            if(e.target.tagName === 'BUTTON') return;
            bird.jump();
        });
        window.addEventListener("keydown", (e) => { if (e.code === "Space") bird.jump(); });
    </script>
</body>
</html>