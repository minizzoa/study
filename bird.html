<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ë‚ ì•„ë¼ ì‚ì•½ì´! âœ¨</title>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <style>
        :root {
            --sky: #87CEEB;
            --btn-main: #ff8b94;
        }
        body { 
            margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; 
            background: #fdf6e3; font-family: 'Jua', sans-serif; overflow: hidden;
            /* ëª¨ë°”ì¼ ë“œë˜ê·¸ ë° ë¡±í„°ì¹˜ ë°©ì§€ */
            touch-action: none; -webkit-user-select: none; user-select: none;
        }

        h1 { margin: 10px 0 5px 0; color: #ff8b94; font-size: 1.8rem; }

        .status-bar {
            width: 90vw; max-width: 360px; display: flex; justify-content: space-between; 
            align-items: center; margin-bottom: 10px; background: white; 
            padding: 8px 15px; border-radius: 12px; box-sizing: border-box;
        }
        .score-info { font-size: 1rem; color: #5d544b; }

        .controls { display: flex; gap: 5px; }
        button {
            padding: 6px 12px; border: none; border-radius: 8px; font-family: 'Jua';
            font-size: 0.9rem; cursor: pointer; color: white;
        }
        .btn-pause { background: #feb236; }
        .btn-restart { background: #ff7b25; }

        #game-container { position: relative; width: 90vw; height: 70vh; max-width: 360px; max-height: 500px; }
        canvas { 
            background: var(--sky); border-radius: 15px; width: 100%; height: 100%;
            display: block; box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        #overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.85); display: none;
            flex-direction: column; align-items: center; justify-content: center;
            border-radius: 15px; z-index: 10;
        }
        
        .guide { margin-top: 10px; color: #888; font-size: 0.9rem; }
    </style>
</head>
<body>

    <h1>ğŸ¤ ë‚ ì•„ë¼ ì‚ì•½ì´! ğŸš€</h1>

    <div class="status-bar">
        <div class="score-info">ì ìˆ˜: <span id="score">0</span> | ìµœê³ : <span id="best">0</span></div>
        <div class="controls">
            <button class="btn-pause" onclick="togglePause(event)" id="pauseBtn">ì¤‘ì§€</button>
            <button class="btn-restart" onclick="resetGame(event)">ë‹¤ì‹œ ì‹œì‘</button>
        </div>
    </div>

    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
        <div id="overlay">
            <h2 style="font-size: 2rem; color: #ff8b94; margin: 0;">ì‚ì•½... í„¸ì©!</h2>
            <p id="finalScore" style="font-size: 1.2rem; margin: 10px 0;"></p>
            <button class="btn-restart" onclick="resetGame(event)" style="padding: 12px 25px; font-size: 1.2rem; background: var(--btn-main);">ë‹¤ì‹œ ë„ì „!</button>
        </div>
    </div>
    
    <p class="guide">í™”ë©´ ì–´ë””ë“  í„°ì¹˜í•˜ë©´ ì‚ì•½ì´ê°€ ë‚ ì•„ì˜¬ë¼ìš”!</p>

    <audio id="jumpSound" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3" preload="auto"></audio>
    <audio id="scoreSound" src="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3" preload="auto"></audio>
    <audio id="hitSound" src="https://assets.mixkit.co/active_storage/sfx/2533/2533-preview.mp3" preload="auto"></audio>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const pauseBtn = document.getElementById("pauseBtn");
        const overlay = document.getElementById("overlay");
        
        // ìº”ë²„ìŠ¤ í¬ê¸° ê³ ì • (ì¢Œí‘œ ê³„ì‚°ìš©)
        const CW = 360;
        const CH = 500;
        canvas.width = CW;
        canvas.height = CH;

        let bird, pipes, score, bestScore = 0, frames, gameActive, isPaused;

        function playSfx(id) {
            const sound = document.getElementById(id);
            sound.currentTime = 0;
            sound.play().catch(() => {});
        }

        class Bird {
            constructor() {
                this.x = 60;
                this.y = CH / 2;
                this.v = 0;
                this.gravity = 0.22;
                this.jumpPower = -4.8;
                this.radius = 16;
            }
            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                // ì†ë„ì— ë”°ë¼ ëª¸ì„ ì‚´ì§ ê¸°ìš¸ì„
                ctx.rotate(Math.min(Math.PI / 4, Math.max(-Math.PI / 4, this.v * 0.1)));
                
                // ëª¸í†µ
                ctx.beginPath(); ctx.arc(0, 0, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = "#FFEB3B"; ctx.fill();
                ctx.strokeStyle = "#FBC02D"; ctx.lineWidth = 3; ctx.stroke();
                // ëˆˆ/ë¶€ë¦¬
                ctx.fillStyle = "black"; ctx.beginPath(); ctx.arc(8, -4, 3, 0, Math.PI * 2); ctx.fill();
                ctx.fillStyle = "#FF9800"; ctx.beginPath(); ctx.moveTo(14, -2); ctx.lineTo(24, 3); ctx.lineTo(14, 8); ctx.fill();
                ctx.restore();
            }
            update() {
                if (isPaused) return;
                this.v += this.gravity;
                this.y += this.v;
                if (this.y + this.radius > CH) endGame();
                if (this.y - this.radius < 0) { this.y = this.radius; this.v = 0; }
            }
            jump() {
                if (isPaused || !gameActive) return;
                this.v = this.jumpPower;
                playSfx('jumpSound');
            }
        }

        function spawnPipe() {
            const gap = 150;
            const top = Math.random() * (CH - gap - 100) + 50;
            pipes.push({ x: CW, top: top, gap: gap, passed: false });
        }

        function togglePause(e) {
            e.stopPropagation(); // ë²„íŠ¼ í´ë¦­ ì‹œ ì í”„ ë°©ì§€
            if (!gameActive) return;
            isPaused = !isPaused;
            pauseBtn.innerText = isPaused ? "ê³„ì†" : "ì¤‘ì§€";
            pauseBtn.style.background = isPaused ? "#4caf50" : "#feb236";
            if (!isPaused) requestAnimationFrame(loop);
        }

        function resetGame(e) {
            if(e) e.stopPropagation();
            bird = new Bird();
            pipes = [];
            score = 0;
            frames = 0;
            gameActive = true;
            isPaused = false;
            overlay.style.display = "none";
            pauseBtn.innerText = "ì¤‘ì§€";
            document.getElementById("score").innerText = "0";
            requestAnimationFrame(loop);
        }

        function endGame() {
            gameActive = false;
            playSfx('hitSound');
            if (score > bestScore) {
                bestScore = score;
                document.getElementById("best").innerText = bestScore;
            }
            document.getElementById("finalScore").innerText = `ì´ë²ˆ ê¸°ë¡: ${score}ì `;
            overlay.style.display = "flex";
        }

        function loop() {
            if (!gameActive || isPaused) return;

            ctx.fillStyle = "#87CEEB";
            ctx.fillRect(0, 0, CW, CH);

            if (frames % 100 === 0) spawnPipe();
            pipes.forEach((p, i) => {
                p.x -= 2.2;
                ctx.fillStyle = "#8BC34A";
                ctx.fillRect(p.x, 0, 50, p.top);
                ctx.fillRect(p.x, p.top + p.gap, 50, CH);
                
                if (bird.x + bird.radius > p.x && bird.x - bird.radius < p.x + 50) {
                    if (bird.y - bird.radius < p.top || bird.y + bird.radius > p.top + p.gap) endGame();
                }

                if (p.x + 50 < bird.x && !p.passed) {
                    score++;
                    p.passed = true;
                    document.getElementById("score").innerText = score;
                    playSfx('scoreSound');
                }
                if (p.x < -50) pipes.splice(i, 1);
            });

            bird.update();
            bird.draw();
            frames++;
            requestAnimationFrame(loop);
        }

        // ëª¨ë°”ì¼ í„°ì¹˜ ì´ë²¤íŠ¸
        window.addEventListener("touchstart", (e) => {
            // ë²„íŠ¼ í´ë¦­ ì‹œì—ëŠ” ì í”„í•˜ì§€ ì•ŠìŒ
            if(e.target.tagName === 'BUTTON') return;
            e.preventDefault();
            bird.jump();
        }, { passive: false });

        // PC í´ë¦­ ë° ìŠ¤í˜ì´ìŠ¤
        window.addEventListener("mousedown", (e) => {
            if(e.target.tagName === 'BUTTON') return;
            bird.jump();
        });
        window.addEventListener("keydown", (e) => { if (e.code === "Space") bird.jump(); });

        resetGame();
    </script>
</body>
</html>