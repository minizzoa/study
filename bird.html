<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ë‚ ì•„ë¼ ì‚ì•½ì´! âœ¨</title>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <style>
        :root {
            --sky: #87CEEB;
            --btn-main: #ff8b94;
        }
        body { 
            margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; 
            background: #fdf6e3; font-family: 'Jua', sans-serif; overflow: hidden;
            touch-action: none; -webkit-user-select: none; user-select: none;
        }

        h1 { margin: 10px 0 5px 0; color: #ff8b94; font-size: 1.8rem; }

        .status-bar {
            width: 90vw; max-width: 360px; display: flex; justify-content: space-between; 
            align-items: center; margin-bottom: 10px; background: white; 
            padding: 8px 15px; border-radius: 12px; box-sizing: border-box;
        }
        .score-info { font-size: 1rem; color: #5d544b; }
        #level-tag { font-size: 0.8rem; background: #ffeb3b; padding: 2px 8px; border-radius: 10px; margin-left: 5px; }

        .controls { display: flex; gap: 5px; }
        button {
            padding: 6px 12px; border: none; border-radius: 8px; font-family: 'Jua';
            font-size: 0.9rem; cursor: pointer; color: white;
        }
        .btn-pause { background: #feb236; }
        .btn-restart { background: #ff7b25; }

        #game-container { position: relative; width: 90vw; height: 70vh; max-width: 360px; max-height: 500px; }
        canvas { 
            background: var(--sky); border-radius: 15px; width: 100%; height: 100%;
            display: block; box-shadow: 0 5px 15px rgba(0,0,0,0.1); transition: background 1s;
        }

        #overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.85); display: none;
            flex-direction: column; align-items: center; justify-content: center;
            border-radius: 15px; z-index: 10;
        }
    </style>
</head>
<body>

    <h1>ğŸš€ ë‚ ì•„ë¼ ì‚ì•½ì´! âœ¨</h1>

    <div class="status-bar">
        <div class="score-info">
            ì ìˆ˜: <span id="score">0</span>
            <span id="level-tag">LEVEL 1</span>
        </div>
        <div class="controls">
            <button class="btn-pause" onclick="togglePause(event)" id="pauseBtn">ì¤‘ì§€</button>
            <button class="btn-restart" onclick="resetGame(event)">ë‹¤ì‹œ ì‹œì‘</button>
        </div>
    </div>

    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
        <div id="overlay">
            <h2 id="end-title" style="font-size: 2rem; color: #ff8b94; margin: 0;">ì‚ì•½... í„¸ì©!</h2>
            <p id="finalScore" style="font-size: 1.2rem; margin: 10px 0;"></p>
            <button class="btn-restart" onclick="resetGame(event)" style="padding: 12px 25px; font-size: 1.2rem; background: var(--btn-main);">ë‹¤ì‹œ ë„ì „!</button>
        </div>
    </div>

    <audio id="jumpSound" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3" preload="auto"></audio>
    <audio id="scoreSound" src="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3" preload="auto"></audio>
    <audio id="hitSound" src="https://assets.mixkit.co/active_storage/sfx/2533/2533-preview.mp3" preload="auto"></audio>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const pauseBtn = document.getElementById("pauseBtn");
        const overlay = document.getElementById("overlay");
        const levelTag = document.getElementById("level-tag");
        
        const CW = 360, CH = 500;
        canvas.width = CW; canvas.height = CH;

        let bird, pipes, score, frames, gameActive, isPaused;
        
        // ë‚œì´ë„ ì¡°ì ˆ ë³€ìˆ˜ë“¤
        let pipeSpeed, pipeGap, spawnInterval;

        function playSfx(id) {
            const sound = document.getElementById(id);
            sound.currentTime = 0;
            sound.play().catch(() => {});
        }

        class Bird {
            constructor() {
                this.x = 60; this.y = CH / 2; this.v = 0;
                this.gravity = 0.22; this.jumpPower = -4.8; this.radius = 16;
            }
            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(Math.min(Math.PI / 4, Math.max(-Math.PI / 4, this.v * 0.1)));
                ctx.beginPath(); ctx.arc(0, 0, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = "#FFEB3B"; ctx.fill();
                ctx.strokeStyle = "#FBC02D"; ctx.lineWidth = 3; ctx.stroke();
                ctx.fillStyle = "black"; ctx.beginPath(); ctx.arc(8, -4, 3, 0, Math.PI * 2); ctx.fill();
                ctx.fillStyle = "#FF9800"; ctx.beginPath(); ctx.moveTo(14, -2); ctx.lineTo(24, 3); ctx.lineTo(14, 8); ctx.fill();
                ctx.restore();
            }
            update() {
                if (isPaused) return;
                this.v += this.gravity;
                this.y += this.v;
                if (this.y + this.radius > CH) endGame();
                if (this.y - this.radius < 0) { this.y = this.radius; this.v = 0; }
            }
            jump() {
                if (isPaused || !gameActive) return;
                this.v = this.jumpPower;
                playSfx('jumpSound');
            }
        }

        function updateDifficulty() {
            // ì ìˆ˜ì— ë¹„ë¡€í•˜ì—¬ ë‚œì´ë„ ê³„ì‚° (ìµœëŒ€ì¹˜ ì„¤ì •ìœ¼ë¡œ ë¬´í•œì • ì–´ë ¤ì›Œì§€ëŠ” ê²ƒ ë°©ì§€)
            pipeSpeed = 2.2 + Math.min(score * 0.15, 2.8); // 2.2ì—ì„œ ìµœëŒ€ 5.0ê¹Œì§€ ë¹¨ë¼ì§
            pipeGap = Math.max(160 - score * 3, 110);    // 160ì—ì„œ ìµœì†Œ 110ê¹Œì§€ ì¢ì•„ì§
            spawnInterval = Math.max(100 - score * 2, 65); // ê¸°ë‘¥ ìƒì„± ê°„ê²©ì´ ì§§ì•„ì§

            // ë ˆë²¨ í‘œì‹œ ë° ë°°ê²½ìƒ‰ ë³€ê²½
            const level = Math.floor(score / 5) + 1;
            levelTag.innerText = `LEVEL ${level}`;
            if (score > 0 && score % 5 === 0) {
                canvas.style.background = `hsl(${200 - score*2}, 70%, 75%)`;
            }
        }

        function spawnPipe() {
            const minH = 50;
            const top = Math.random() * (CH - pipeGap - minH * 2) + minH;
            pipes.push({ x: CW, top: top, gap: pipeGap, passed: false });
        }

        function togglePause(e) {
            e.stopPropagation();
            if (!gameActive) return;
            isPaused = !isPaused;
            pauseBtn.innerText = isPaused ? "ê³„ì†" : "ì¤‘ì§€";
            pauseBtn.style.background = isPaused ? "#4caf50" : "#feb236";
            if (!isPaused) requestAnimationFrame(loop);
        }

        function resetGame(e) {
            if(e) e.stopPropagation();
            bird = new Bird();
            pipes = []; score = 0; frames = 0;
            gameActive = true; isPaused = false;
            canvas.style.background = "var(--sky)";
            overlay.style.display = "none";
            updateDifficulty();
            document.getElementById("score").innerText = "0";
            requestAnimationFrame(loop);
        }

        function endGame() {
            gameActive = false;
            playSfx('hitSound');
            document.getElementById("finalScore").innerText = `${score}ì  ë‹¬ì„±!`;
            overlay.style.display = "flex";
        }

        function loop() {
            if (!gameActive || isPaused) return;

            ctx.clearRect(0, 0, CW, CH);
            
            // ë‚œì´ë„ ì—…ë°ì´íŠ¸
            updateDifficulty();

            if (frames % Math.floor(spawnInterval) === 0) spawnPipe();
            
            pipes.forEach((p, i) => {
                p.x -= pipeSpeed;
                ctx.fillStyle = "#8BC34A";
                ctx.fillRect(p.x, 0, 50, p.top);
                ctx.fillRect(p.x, p.top + p.gap, 50, CH);
                
                if (bird.x + bird.radius > p.x && bird.x - bird.radius < p.x + 50) {
                    if (bird.y - bird.radius < p.top || bird.y + bird.radius > p.top + p.gap) endGame();
                }

                if (p.x + 50 < bird.x && !p.passed) {
                    score++;
                    p.passed = true;
                    document.getElementById("score").innerText = score;
                    playSfx('scoreSound');
                }
                if (p.x < -50) pipes.splice(i, 1);
            });

            bird.update();
            bird.draw();
            frames++;
            requestAnimationFrame(loop);
        }

        window.addEventListener("touchstart", (e) => {
            if(e.target.tagName === 'BUTTON') return;
            e.preventDefault(); bird.jump();
        }, { passive: false });
        window.addEventListener("mousedown", (e) => {
            if(e.target.tagName === 'BUTTON') return;
            bird.jump();
        });
        window.addEventListener("keydown", (e) => { if (e.code === "Space") bird.jump(); });

        resetGame();
    </script>
</body>
</html>