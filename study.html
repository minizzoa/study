<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•˜ë£¨ ë‹¨ì–´ âš¡ ë§ˆìŠ¤í„°</title>
    <script src="word_list.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root { --primary: #FFD93D; --secondary: #6C63FF; --success: #22c55e; --error: #ef4444; --text: #2D3436; }
        body { font-family: 'Pretendard', sans-serif; background: var(--secondary); display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; overflow: hidden; }
        
        #app { background: white; width: 95%; max-width: 480px; padding: 20px; border-radius: 30px; box-shadow: 0 20px 0 rgba(0,0,0,0.2); text-align: center; }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding: 0 5px; }
        .mode-group { display: flex; gap: 5px; align-items: center; }
        .btn-mini { border: none; padding: 5px 10px; border-radius: 8px; font-size: 0.8rem; cursor: pointer; background: #eee; transition: 0.2s; }
        .btn-mini.active { background: var(--secondary); color: white; }

        .stats { display: flex; justify-content: space-around; background: #f8f9fa; padding: 10px; border-radius: 15px; margin-bottom: 15px; font-weight: bold; }
        
        .timer-container { width: 100%; height: 10px; background: #eee; border-radius: 5px; margin-bottom: 15px; overflow: hidden; }
        #timer-bar { width: 100%; height: 100%; background: var(--error); transition: width 0.1s linear; }

        .word-box { font-size: 2.5rem; font-weight: 800; color: var(--secondary); min-height: 80px; display: flex; align-items: center; justify-content: center; }
        #feedback-area { height: 40px; font-size: 1.5rem; font-weight: 900; display: flex; align-items: center; justify-content: center; }

        .input-row { display: flex; gap: 8px; margin-bottom: 15px; }
        input { flex: 4; padding: 15px; border: 3px solid #EEE; border-radius: 15px; font-size: 1.2rem; text-align: center; outline: none; }
        .btn-confirm { flex: 1.2; background: var(--primary); border: none; border-radius: 15px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 0 #E6C235; }

        .control-row { display: flex; gap: 8px; margin-bottom: 8px; }
        .btn-ctrl { background: #dfe6e9; border: none; padding: 12px; border-radius: 15px; font-weight: bold; cursor: pointer; flex: 1; transition: 0.2s; }
        .btn-pause { background: #fab1a0; color: #d63031; }
        
        .speed-ctrl { flex: 2; background: #f1f2f6; border-radius: 15px; display: flex; align-items: center; justify-content: space-around; }
        .speed-btn { border: none; background: none; font-size: 1.2rem; cursor: pointer; padding: 5px 10px; color: var(--secondary); font-weight: 900; }
        
        .speed-presets { width: 100%; display: flex; gap: 5px; }
        .btn-speed { flex: 1; padding: 8px; font-size: 0.75rem; border: none; border-radius: 8px; cursor: pointer; background: #f1f2f6; }

        #perfect-screen { display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(108, 99, 255, 0.98); color: white; z-index: 1000; flex-direction: column; justify-content: center; align-items: center; }
        .btn-restart { padding: 10px 25px; font-size: 1rem; border-radius: 10px; margin-top: 20px; border: none; background: var(--primary); cursor: pointer; }
    </style>
</head>
<body>

<div id="perfect-screen">
    <h1 style="font-size: 3.5rem; margin-bottom: 10px;">PERFECT! ğŸ†</h1>
    <p>ëª¨ë“  ë‹¨ì–´ë¥¼ ë§ˆìŠ¤í„°í–ˆìŠµë‹ˆë‹¤!</p>
    <button class="btn-restart" onclick="location.reload()">ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button>
</div>

<div id="app">
    <div class="header">
        <span id="sound-toggle" style="cursor:pointer; font-size: 1.5rem;">ğŸ”Š</span>
        <div class="mode-group">
            <button class="btn-mini active" onclick="setCategory('ENG_TO_KOR', this)">ì˜í•œ</button>
            <button class="btn-mini" onclick="setCategory('KOR_TO_ENG', this)">í•œì˜</button>
            <button class="btn-mini" onclick="setCategory('RANDOM', this)">ëœë¤</button>
        </div>
    </div>

    <div class="stats">
        <span>ì ìˆ˜: <span id="score" style="color:var(--secondary)">0</span></span>
        <span id="limit-display" style="color:#636e72">ì œí•œì‹œê°„: 10s</span>
    </div>

    <div class="timer-container"><div id="timer-bar"></div></div>
    <div class="word-box" id="question-text">...</div>
    <div id="feedback-area"></div>
    
    <div class="input-row">
        <input type="text" id="user-input" placeholder="ì •ë‹µ ì…ë ¥" autocomplete="off">
        <button class="btn-confirm" onclick="checkAnswer()">í™•ì¸</button>
    </div>
    
    <div class="control-row">
        <button class="btn-ctrl" onclick="passQuestion()">PASS</button>
        <button class="btn-ctrl btn-pause" id="pause-btn" onclick="togglePause()">â¸ ì •ì§€</button>
        <div class="speed-ctrl">
            <button class="speed-btn" onclick="adjustSpeed(-1)">-</button>
            <span id="speed-val" style="font-weight: bold; font-size: 0.9rem;">10s</span>
            <button class="speed-btn" onclick="adjustSpeed(1)">+</button>
        </div>
    </div>

    <div class="speed-presets">
        <button class="btn-speed" onclick="setSpeed(150)">ğŸ¢ 15s</button>
        <button class="btn-speed" onclick="setSpeed(100)">ğŸ˜ 10s</button>
        <button class="btn-speed" onclick="setSpeed(60)">âš¡ 6s</button>
    </div>
</div>

<script>
    let score = 0;
    let currentIndex = 0;
    let soundEnabled = true;
    let isPaused = false;
    let category = 'ENG_TO_KOR';
    let currentQuizMode = 'ENG_TO_KOR';
    let baseTime = 100;
    let timeLeft = 100;
    let timerInterval;
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    window.onload = () => { if(typeof wordData !== 'undefined') nextQuestion(); };

    function togglePause() {
        if (document.getElementById('user-input').disabled && !isPaused) return; 
        isPaused = !isPaused;
        const btn = document.getElementById('pause-btn');
        const input = document.getElementById('user-input');
        
        if (isPaused) {
            btn.innerText = "â–¶ï¸ ì‹œì‘";
            btn.style.background = "#55efc4";
            btn.style.color = "#00b894";
            input.disabled = true;
            input.placeholder = "ì¼ì‹œì •ì§€ ì¤‘...";
        } else {
            btn.innerText = "â¸ ì •ì§€";
            btn.style.background = "#fab1a0";
            btn.style.color = "#d63031";
            input.disabled = false;
            input.placeholder = "ì •ë‹µ ì…ë ¥";
            input.focus();
        }
    }

    function setCategory(mode, btn) {
        category = mode;
        document.querySelectorAll('.btn-mini').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        isPaused = false;
        nextQuestion();
    }

    function adjustSpeed(val) {
        baseTime = Math.max(10, baseTime + (val * 10));
        updateSpeedUI();
    }

    function setSpeed(val) {
        baseTime = val;
        updateSpeedUI();
    }

    function updateSpeedUI() {
        document.getElementById('speed-val').innerText = (baseTime/10) + 's';
        document.getElementById('limit-display').innerText = `ì œí•œì‹œê°„: ${baseTime/10}s`;
    }

    function startTimer() {
        clearInterval(timerInterval);
        timeLeft = baseTime;
        updateTimerBar();
        timerInterval = setInterval(() => {
            if (!isPaused) {
                timeLeft--;
                updateTimerBar();
                if (timeLeft <= 0) { clearInterval(timerInterval); handleWrongProcess('â° ì‹œê°„ì´ˆê³¼!'); }
            }
        }, 100);
    }

    function updateTimerBar() {
        document.getElementById('timer-bar').style.width = (timeLeft / baseTime) * 100 + "%";
    }

    function handleWrongProcess(msg) {
        clearInterval(timerInterval);
        playWrongSound();
        triggerFeedback(msg, 'var(--error)');
        const currentWord = wordData[currentIndex];
        const correctAnswer = currentQuizMode === 'ENG_TO_KOR' ? currentWord.meaning : currentWord.english;
        const inputEl = document.getElementById('user-input');
        inputEl.value = `ì •ë‹µ: ${correctAnswer}`;
        inputEl.disabled = true;
        setTimeout(nextQuestion, 1500);
    }

    function nextQuestion() {
        if (score >= 100) { showPerfect(); return; }
        isPaused = false;
        const pauseBtn = document.getElementById('pause-btn');
        pauseBtn.innerText = "â¸ ì •ì§€";
        pauseBtn.style.background = "#fab1a0";
        pauseBtn.style.color = "#d63031";

        clearInterval(timerInterval);
        document.getElementById('feedback-area').innerText = '';
        currentIndex = Math.floor(Math.random() * wordData.length);
        
        if (category === 'RANDOM') {
            currentQuizMode = Math.random() > 0.5 ? 'ENG_TO_KOR' : 'KOR_TO_ENG';
        } else {
            currentQuizMode = category;
        }

        const currentWord = wordData[currentIndex];
        document.getElementById('question-text').innerText = currentQuizMode === 'ENG_TO_KOR' ? currentWord.english : currentWord.meaning;
        
        const inputEl = document.getElementById('user-input');
        inputEl.value = '';
        inputEl.disabled = false;
        inputEl.placeholder = "ì •ë‹µ ì…ë ¥";
        inputEl.focus();
        startTimer();
    }

    function checkAnswer() {
        if (document.getElementById('user-input').disabled || isPaused) return;
        const userInput = document.getElementById('user-input').value.trim().toLowerCase();
        const currentWord = wordData[currentIndex];
        const answerRaw = currentQuizMode === 'ENG_TO_KOR' ? currentWord.meaning : currentWord.english;
        const correctAnswers = answerRaw.split(',').map(s => s.trim().toLowerCase());

        if (correctAnswers.includes(userInput)) {
            clearInterval(timerInterval);
            score += 10;
            document.getElementById('score').innerText = score;
            triggerFeedback('â­• ì •ë‹µì…ë‹ˆë‹¤!', 'var(--success)');
            playTone(600, 0.1, 0.2, 'sine');
            setTimeout(nextQuestion, 800);
        } else {
            handleWrongProcess('âŒ í‹€ë ¸ì–´ìš”!');
        }
    }

    function passQuestion() { if (!document.getElementById('user-input').disabled) handleWrongProcess('PASS â©'); }

    function showPerfect() {
        clearInterval(timerInterval);
        document.getElementById('perfect-screen').style.display = 'flex';
        playVictorySound();
        const end = Date.now() + 3000;
        (function frame() {
            confetti({ particleCount: 5, angle: 60, spread: 55, origin: { x: 0 } });
            confetti({ particleCount: 5, angle: 120, spread: 55, origin: { x: 1 } });
            if (Date.now() < end) requestAnimationFrame(frame);
        }());
    }

    function triggerFeedback(text, color) {
        const area = document.getElementById('feedback-area');
        area.innerText = text;
        area.style.color = color;
    }

    function playTone(freq, vol, duration, type = 'sine') {
        if(!soundEnabled) return;
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(vol, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
        osc.start(); osc.stop(audioCtx.currentTime + duration);
    }

    function playVictorySound() { [523, 659, 783, 1046].forEach((f, i) => setTimeout(() => playTone(f, 0.1, 0.5, 'triangle'), i * 150)); }
    
    // ì˜¤ë‹µ ì‚¬ìš´ë“œ: ì›…ì¥í•˜ê³  ë‚®ì€ ë¶ˆí˜‘í™”ìŒ
    function playWrongSound() { 
        playTone(150, 0.2, 0.4, 'sawtooth');
        playTone(110, 0.2, 0.4, 'square');
    }

    document.getElementById('sound-toggle').onclick = function() {
        soundEnabled = !soundEnabled;
        this.innerText = soundEnabled ? 'ğŸ”Š' : 'ğŸ”ˆ';
    };

    document.getElementById('user-input').addEventListener('keypress', (e) => { if(e.key === 'Enter') checkAnswer(); });
</script>
</body>
</html>
