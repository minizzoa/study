<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜¤ëŠ˜ì˜ ë‹¨ì–´ ğŸ“– ë§ˆìŠ¤í„°</title>
    <script src="word_list.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;900&display=swap');

        :root { --primary: #FFD93D; --secondary: #5F56D6; --success: #22c55e; --error: #ef4444; --text: #2D3436; }
        
        /* ìœ„ì¹˜ ìƒë‹¨ ì´ë™: align-itemsë¥¼ flex-startë¡œ ë³€ê²½í•˜ê³  ìƒë‹¨ ì—¬ë°± ì¶”ê°€ */
        body { font-family: 'Pretendard', sans-serif; background: var(--secondary); display: flex; justify-content: center; align-items: flex-start; height: 100vh; margin: 0; padding-top: 5vh; overflow: hidden; }
        
        #app { background: white; width: 92%; max-width: 440px; padding: 20px; border-radius: 35px; box-shadow: 0 15px 0 rgba(0,0,0,0.2); text-align: center; }
        
        /* ì œëª© êµµê²Œ ë° ê°€ë…ì„± ê°•í™” */
        .app-title { font-size: 2.5rem; font-weight: 900; color: var(--secondary); margin: 0 0 15px 0; display: flex; align-items: center; justify-content: center; gap: 10px; letter-spacing: -1.5px; }

        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding: 8px 0; border-top: 1.5px dashed #eee; }
        .mode-group { display: flex; gap: 4px; }
        .btn-mini { border: none; padding: 5px 10px; border-radius: 8px; font-size: 0.8rem; cursor: pointer; background: #f1f2f6; font-weight: 600; transition: 0.2s; }
        .btn-mini.active { background: var(--secondary); color: white; }

        .stats { display: flex; justify-content: space-around; background: #f8f9fa; padding: 10px; border-radius: 15px; margin-bottom: 12px; font-weight: 600; font-size: 0.95rem; }
        
        .timer-container { width: 100%; height: 10px; background: #eee; border-radius: 5px; margin-bottom: 12px; overflow: hidden; }
        #timer-bar { width: 100%; height: 100%; background: var(--error); transition: width 0.1s linear; }

        .word-box { font-size: 2.8rem; font-weight: 900; color: var(--secondary); min-height: 80px; display: flex; align-items: center; justify-content: center; }
        #feedback-area { height: 35px; font-size: 1.5rem; font-weight: 900; display: flex; align-items: center; justify-content: center; }

        /* ì…ë ¥ë€ ìƒ‰ìƒ ë° ìŠ¤íƒ€ì¼ ê°•í™” */
        .input-row { display: flex; gap: 8px; margin-bottom: 12px; }
        input { flex: 4; padding: 14px; border: 3px solid #E0DFFD; background-color: #F8F7FF; border-radius: 18px; font-size: 1.2rem; text-align: center; outline: none; transition: 0.3s; color: var(--secondary); font-weight: 600; }
        input:focus { border-color: var(--secondary); background-color: #FFFFFF; box-shadow: 0 0 10px rgba(95, 86, 214, 0.2); }
        input::placeholder { color: #A29BFE; }
        
        .btn-confirm { flex: 1.2; background: var(--primary); border: none; border-radius: 18px; font-weight: 900; cursor: pointer; box-shadow: 0 4px 0 #E6C235; transition: 0.1s; }
        .btn-confirm:active { transform: translateY(3px); box-shadow: none; }

        .control-row { display: flex; gap: 6px; margin-bottom: 8px; }
        .btn-ctrl { background: #dfe6e9; border: none; padding: 10px; border-radius: 15px; font-weight: 600; cursor: pointer; flex: 1; font-size: 0.9rem; box-shadow: 0 3px 0 #b2bec3; }
        .btn-pause { background: #ff7675; color: white; box-shadow: 0 3px 0 #d63031; }
        
        .speed-ctrl { flex: 1.8; background: #f1f2f6; border-radius: 15px; display: flex; align-items: center; justify-content: space-around; }
        .speed-btn { border: none; background: none; font-size: 1.2rem; cursor: pointer; color: var(--secondary); font-weight: 900; }
        
        .speed-presets { width: 100%; display: flex; gap: 4px; }
        .btn-speed { flex: 1; padding: 8px; font-size: 0.75rem; border: none; border-radius: 10px; cursor: pointer; background: #f1f2f6; font-weight: 600; color: #636e72; }

        #perfect-screen { display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(95, 86, 214, 0.98); color: white; z-index: 1000; flex-direction: column; justify-content: center; align-items: center; }
    </style>
</head>
<body>

<div id="perfect-screen">
    <h1 style="font-size: 3.5rem; font-weight: 900;">ğŸ† PERFECT!</h1>
    <p style="font-size: 1.3rem;">ëª¨ë“  ë‹¨ì–´ë¥¼ ë§ˆìŠ¤í„°í–ˆìŠµë‹ˆë‹¤!</p>
    <button style="padding: 12px 30px; border-radius: 15px; border:none; background:var(--primary); font-weight:900; cursor:pointer; margin-top:20px; box-shadow: 0 5px 0 #E6C235;" onclick="location.reload()">ë‹¤ì‹œ ì‹œì‘</button>
</div>

<div id="app">
    <h1 class="app-title"><span>ğŸ“–</span> ì˜¤ëŠ˜ì˜ ë‹¨ì–´</h1>

    <div class="header">
        <span id="sound-toggle" style="cursor:pointer; font-size: 1.5rem;">ğŸ”Š</span>
        <div class="mode-group">
            <button class="btn-mini active" onclick="setCategory('ENG_TO_KOR', this)">ì˜í•œ</button>
            <button class="btn-mini" onclick="setCategory('KOR_TO_ENG', this)">í•œì˜</button>
            <button class="btn-mini" onclick="setCategory('RANDOM', this)">ëœë¤</button>
        </div>
    </div>

    <div class="stats">
        <span>ì ìˆ˜: <span id="score" style="color:var(--secondary)">0</span></span>
        <span id="limit-display" style="color:#636e72">â± 10.0s</span>
    </div>

    <div class="timer-container"><div id="timer-bar"></div></div>
    <div class="word-box" id="question-text">...</div>
    <div id="feedback-area"></div>
    
    <div class="input-row">
        <input type="text" id="user-input" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”" autocomplete="off">
        <button class="btn-confirm" onclick="checkAnswer()">í™•ì¸</button>
    </div>
    
    <div class="control-row">
        <button class="btn-ctrl" onclick="passQuestion()">PASS</button>
        <button class="btn-ctrl btn-pause" id="pause-btn" onclick="togglePause()">â¸ ì •ì§€</button>
        <div class="speed-ctrl">
            <button class="speed-btn" onclick="adjustSpeed(-1)">âˆ’</button>
            <span id="speed-val" style="font-weight: 900;">10s</span>
            <button class="speed-btn" onclick="adjustSpeed(1)">+</button>
        </div>
    </div>

    <div class="speed-presets">
        <button class="btn-speed" onclick="setSpeed(150)">ğŸ¢ 15s</button>
        <button class="btn-speed" onclick="setSpeed(100)">ğŸ˜ 10s</button>
        <button class="btn-speed" onclick="setSpeed(60)">âš¡ 6s</button>
    </div>
</div>

<script>
    // [ì´ì „ ìŠ¤í¬ë¦½íŠ¸ ë¡œì§ ìœ ì§€ - í‹±ì†Œë¦¬, íƒ€ì´ë¨¸, ì •ë‹µ í™•ì¸ ë“± ëª¨ë“  ê¸°ëŠ¥ í¬í•¨]
    let score = 0, currentIndex = 0, soundEnabled = true, isPaused = false;
    let category = 'ENG_TO_KOR', currentQuizMode = 'ENG_TO_KOR', baseTime = 100, timeLeft = 100, timerInterval;
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    window.onload = () => { if(typeof wordData !== 'undefined') nextQuestion(); };

    function playTickSound() {
        if(!soundEnabled || isPaused) return;
        const pitch = timeLeft < 30 ? 800 : 400;
        playTone(pitch, 0.02, 0.05, 'sine');
    }

    function togglePause() {
        if (document.getElementById('user-input').disabled && !isPaused) return; 
        isPaused = !isPaused;
        const btn = document.getElementById('pause-btn');
        const input = document.getElementById('user-input');
        btn.innerHTML = isPaused ? "â–¶ï¸ ì‹œì‘" : "â¸ ì •ì§€";
        btn.style.background = isPaused ? "#55efc4" : "#ff7675";
        input.disabled = isPaused;
        if(!isPaused) input.focus();
    }

    function setCategory(mode, btn) {
        category = mode;
        document.querySelectorAll('.btn-mini').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        nextQuestion();
    }

    function adjustSpeed(val) { baseTime = Math.max(10, baseTime + (val * 10)); updateSpeedUI(); }
    function setSpeed(val) { baseTime = val; updateSpeedUI(); }
    function updateSpeedUI() {
        document.getElementById('speed-val').innerText = (baseTime/10) + 's';
        document.getElementById('limit-display').innerText = `â± ${(baseTime/10).toFixed(1)}s`;
    }

    function startTimer() {
        clearInterval(timerInterval);
        timeLeft = baseTime;
        updateTimerBar();
        timerInterval = setInterval(() => {
            if (!isPaused) {
                timeLeft--;
                updateTimerBar();
                if (timeLeft % 10 === 0) playTickSound();
                if (timeLeft <= 0) { clearInterval(timerInterval); handleWrongProcess('â° ì‹œê°„ì´ˆê³¼!'); }
            }
        }, 100);
    }

    function updateTimerBar() { document.getElementById('timer-bar').style.width = (timeLeft / baseTime) * 100 + "%"; }

    function handleWrongProcess(msg) {
        clearInterval(timerInterval);
        playWrongSound();
        triggerFeedback(msg, 'var(--error)');
        const currentWord = wordData[currentIndex];
        const correctAnswer = currentQuizMode === 'ENG_TO_KOR' ? currentWord.meaning : currentWord.english;
        document.getElementById('user-input').value = `ì •ë‹µ: ${correctAnswer}`;
        document.getElementById('user-input').disabled = true;
        setTimeout(nextQuestion, 1500);
    }

    function nextQuestion() {
        if (score >= 100) { showPerfect(); return; }
        isPaused = false;
        clearInterval(timerInterval);
        document.getElementById('feedback-area').innerText = '';
        currentIndex = Math.floor(Math.random() * wordData.length);
        currentQuizMode = category === 'RANDOM' ? (Math.random() > 0.5 ? 'ENG_TO_KOR' : 'KOR_TO_ENG') : category;
        const currentWord = wordData[currentIndex];
        document.getElementById('question-text').innerText = currentQuizMode === 'ENG_TO_KOR' ? currentWord.english : currentWord.meaning;
        const inputEl = document.getElementById('user-input');
        inputEl.value = ''; inputEl.disabled = false; inputEl.focus();
        startTimer();
    }

    function checkAnswer() {
        if (document.getElementById('user-input').disabled || isPaused) return;
        const userInput = document.getElementById('user-input').value.trim().toLowerCase();
        const currentWord = wordData[currentIndex];
        const answerRaw = currentQuizMode === 'ENG_TO_KOR' ? currentWord.meaning : currentWord.english;
        const correctAnswers = answerRaw.split(',').map(s => s.trim().toLowerCase());
        if (correctAnswers.includes(userInput)) {
            clearInterval(timerInterval);
            score += 10;
            document.getElementById('score').innerText = score;
            triggerFeedback('â­• ì •ë‹µì…ë‹ˆë‹¤!', 'var(--success)');
            playTone(600, 0.1, 0.2, 'sine');
            setTimeout(nextQuestion, 800);
        } else { handleWrongProcess('âŒ í‹€ë ¸ì–´ìš”!'); }
    }

    function passQuestion() { if (!document.getElementById('user-input').disabled) handleWrongProcess('PASS â©'); }
    function showPerfect() { document.getElementById('perfect-screen').style.display = 'flex'; playVictorySound(); confetti({ particleCount: 150, spread: 70 }); }
    function triggerFeedback(text, color) { const area = document.getElementById('feedback-area'); area.innerText = text; area.style.color = color; }

    function playTone(freq, vol, duration, type = 'sine') {
        if(!soundEnabled) return;
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type; osc.connect(gain); gain.connect(audioCtx.destination);
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(vol, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
        osc.start(); osc.stop(audioCtx.currentTime + duration);
    }
    function playVictorySound() { [523, 659, 783, 1046].forEach((f, i) => setTimeout(() => playTone(f, 0.1, 0.5, 'triangle'), i * 150)); }
    function playWrongSound() { playTone(150, 0.2, 0.4, 'sawtooth'); playTone(110, 0.2, 0.4, 'square'); }
    document.getElementById('sound-toggle').onclick = function() { soundEnabled = !soundEnabled; this.innerText = soundEnabled ? 'ğŸ”Š' : 'ğŸ”ˆ'; };
    document.getElementById('user-input').addEventListener('keypress', (e) => { if(e.key === 'Enter') checkAnswer(); });
</script>
</body>
</html>
