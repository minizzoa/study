<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜¤ëŠ˜ì˜ ë‹¨ì–´ ğŸ“– ë§ˆìŠ¤í„°</title>
    <script src="word_list.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;900&display=swap');

        :root { --primary: #FFD93D; --secondary: #5F56D6; --success: #22c55e; --error: #ef4444; --text: #2D3436; }
        
        body { font-family: 'Pretendard', sans-serif; background: var(--secondary); display: flex; justify-content: center; align-items: flex-start; height: 100vh; margin: 0; padding-top: 5vh; overflow: hidden; }
        
        /* í­ì£½ì´ ì´ ë°•ìŠ¤ ì•ˆì—ì„œë§Œ ë³´ì´ë„ë¡ position: relativeì™€ overflow: hidden ì„¤ì • */
        #app { background: white; width: 92%; max-width: 440px; padding: 25px 20px; border-radius: 35px; box-shadow: 0 15px 0 rgba(0,0,0,0.2); text-align: center; min-height: 420px; position: relative; overflow: hidden; }
        
        .app-title { font-size: 2.5rem; font-weight: 900; color: var(--secondary); margin: 0 0 15px 0; display: flex; align-items: center; justify-content: center; gap: 10px; letter-spacing: -1.5px; }

        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding: 8px 0; border-top: 1.5px dashed #eee; }
        .mode-group { display: flex; gap: 4px; }
        .btn-mini { border: none; padding: 5px 10px; border-radius: 8px; font-size: 0.8rem; cursor: pointer; background: #f1f2f6; font-weight: 600; transition: 0.2s; }
        .btn-mini.active { background: var(--secondary); color: white; }

        .stats { display: flex; justify-content: space-between; align-items: center; background: #f8f9fa; padding: 12px 18px; border-radius: 20px; margin-bottom: 15px; font-weight: 800; font-size: 1.1rem; }
        
        .speed-adj-group { display: flex; align-items: center; gap: 8px; background: white; padding: 4px 10px; border-radius: 12px; box-shadow: inset 0 2px 4px rgba(0,0,0,0.05); }
        .btn-adj { border: none; background: none; color: var(--secondary); font-size: 1.3rem; font-weight: 900; cursor: pointer; padding: 0 5px; transition: 0.1s; }
        .btn-adj:active { transform: scale(1.3); }
        #limit-display { color: var(--text); min-width: 65px; text-align: center; font-size: 1.1rem; }

        .timer-container { width: 100%; height: 10px; background: #eee; border-radius: 5px; margin-bottom: 15px; overflow: hidden; }
        #timer-bar { width: 100%; height: 100%; background: var(--error); transition: width 0.1s linear; }

        .word-box { font-size: 2.8rem; font-weight: 900; color: var(--secondary); min-height: 80px; display: flex; align-items: center; justify-content: center; }
        #feedback-area { height: 35px; font-size: 1.5rem; font-weight: 900; display: flex; align-items: center; justify-content: center; }

        .input-row { display: flex; gap: 8px; margin-bottom: 12px; }
        input { flex: 4; padding: 14px; border: 3px solid #E0DFFD; background-color: #F8F7FF; border-radius: 18px; font-size: 1.2rem; text-align: center; outline: none; transition: 0.3s; color: var(--secondary); font-weight: 600; }
        
        .btn-confirm { flex: 1.5; background: var(--primary); border: none; border-radius: 18px; font-weight: 900; font-size: 1.2rem; cursor: pointer; box-shadow: 0 4px 0 #E6C235; transition: 0.1s; }
        .btn-confirm:active { transform: translateY(3px); box-shadow: none; }

        .control-row { display: flex; gap: 8px; }
        .btn-ctrl { background: #dfe6e9; border: none; padding: 12px; border-radius: 18px; font-weight: 600; cursor: pointer; flex: 1; font-size: 1rem; box-shadow: 0 3px 0 #b2bec3; }
        .btn-pause { background: #ff7675; color: white; box-shadow: 0 3px 0 #d63031; }
        
        .result-view { animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); padding: 30px 0; z-index: 10; position: relative; }
        @keyframes popIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body>

<div id="app">
    <div id="game-container">
        <h1 class="app-title"><span>ğŸ“–</span> ì˜¤ëŠ˜ì˜ ë‹¨ì–´</h1>

        <div class="header">
            <span id="sound-toggle" style="cursor:pointer; font-size: 1.5rem;">ğŸ”Š</span>
            <div class="mode-group">
                <button class="btn-mini active" onclick="setCategory('ENG_TO_KOR', this)">ì˜í•œ</button>
                <button class="btn-mini" onclick="setCategory('KOR_TO_ENG', this)">í•œì˜</button>
                <button class="btn-mini" onclick="setCategory('RANDOM', this)">ëœë¤</button>
            </div>
        </div>

        <div class="stats">
            <span>ì ìˆ˜: <span id="score" style="color:var(--secondary); font-size: 1.3rem;">0</span></span>
            <div class="speed-adj-group">
                <button class="btn-adj" onclick="changeSpeed(-10)">âˆ’</button>
                <span id="limit-display">â± 10.0s</span>
                <button class="btn-adj" onclick="changeSpeed(10)">+</button>
            </div>
        </div>

        <div class="timer-container"><div id="timer-bar"></div></div>
        <div class="word-box" id="question-text">...</div>
        <div id="feedback-area"></div>
        
        <div class="input-row">
            <input type="text" id="user-input" placeholder="ì •ë‹µ ì…ë ¥" autocomplete="off">
            <button class="btn-confirm" onclick="checkAnswer()">í™•ì¸</button>
        </div>
        
        <div class="control-row">
            <button class="btn-ctrl" onclick="passQuestion()">PASS</button>
            <button class="btn-ctrl btn-pause" id="pause-btn" onclick="togglePause()">â¸ ì •ì§€</button>
        </div>
    </div>
</div>

<script>
    let score = 0, currentIndex = 0, soundEnabled = true, isPaused = false;
    let category = 'ENG_TO_KOR', currentQuizMode = 'ENG_TO_KOR', baseTime = 100, timeLeft = 100, timerInterval;

    const sndCorrect = new Audio('https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3');
    const sndWrong = new Audio('https://assets.mixkit.co/active_storage/sfx/2014/2014-preview.mp3');
    const sndTick = new Audio('https://assets.mixkit.co/active_storage/sfx/2544/2544-preview.mp3'); 
    const sndSuccess = new Audio('https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3');
    sndTick.volume = 0.3;

    function playSnd(audioObj) {
        if (soundEnabled) {
            audioObj.currentTime = 0;
            audioObj.play().catch(e => {});
        }
    }

    window.onload = () => { if(typeof wordData !== 'undefined') nextQuestion(); };

    function changeSpeed(delta) {
        let newTime = baseTime + delta;
        if (newTime >= 10 && newTime <= 300) { 
            baseTime = newTime;
            document.getElementById('limit-display').innerText = `â± ${(baseTime / 10).toFixed(1)}s`;
        }
    }

    function togglePause() {
        if (document.getElementById('user-input').disabled && !isPaused) return; 
        isPaused = !isPaused;
        const btn = document.getElementById('pause-btn');
        const input = document.getElementById('user-input');
        btn.innerHTML = isPaused ? "â–¶ï¸ ì‹œì‘" : "â¸ ì •ì§€";
        btn.style.background = isPaused ? "#55efc4" : "#ff7675";
        input.disabled = isPaused;
        if(!isPaused) input.focus();
    }

    function startTimer() {
        clearInterval(timerInterval);
        timeLeft = baseTime;
        updateTimerBar();
        timerInterval = setInterval(() => {
            if (!isPaused) {
                timeLeft--;
                updateTimerBar();
                if (timeLeft % 10 === 0 && timeLeft > 0) playSnd(sndTick);
                if (timeLeft <= 0) { clearInterval(timerInterval); handleWrongProcess('â° ì‹œê°„ì´ˆê³¼!'); }
            }
        }, 100);
    }

    function updateTimerBar() { document.getElementById('timer-bar').style.width = (timeLeft / baseTime) * 100 + "%"; }

    function handleWrongProcess(msg) {
        clearInterval(timerInterval);
        playSnd(sndWrong);
        triggerFeedback(msg, 'var(--error)');
        const currentWord = wordData[currentIndex];
        const correctAnswer = currentQuizMode === 'ENG_TO_KOR' ? currentWord.meaning : currentWord.english;
        document.getElementById('user-input').value = `ì •ë‹µ: ${correctAnswer}`;
        document.getElementById('user-input').disabled = true;
        setTimeout(nextQuestion, 1500);
    }

    function nextQuestion() {
        if (score >= 100) { showPerfect(); return; }
        isPaused = false;
        clearInterval(timerInterval);
        document.getElementById('feedback-area').innerText = '';
        currentIndex = Math.floor(Math.random() * wordData.length);
        currentQuizMode = category === 'RANDOM' ? (Math.random() > 0.5 ? 'ENG_TO_KOR' : 'KOR_TO_ENG') : category;
        document.getElementById('question-text').innerText = currentQuizMode === 'ENG_TO_KOR' ? wordData[currentIndex].english : wordData[currentIndex].meaning;
        const inputEl = document.getElementById('user-input');
        inputEl.value = ''; inputEl.disabled = false; inputEl.focus();
        startTimer();
    }

    function checkAnswer() {
        if (document.getElementById('user-input').disabled || isPaused) return;
        
        // ì •ë‹µ ì²´í¬ ë¡œì§ ìˆ˜ì •: ëª¨ë“  ê³µë°± ì œê±° í›„ ë¹„êµ
        const userInput = document.getElementById('user-input').value.replace(/\s+/g, '').toLowerCase();
        const currentWord = wordData[currentIndex];
        const answerRaw = currentQuizMode === 'ENG_TO_KOR' ? currentWord.meaning : currentWord.english;
        
        // ì •ë‹µì§€ ë¦¬ìŠ¤íŠ¸ë„ ê³µë°± ì œê±°í•˜ì—¬ ë°°ì—´í™”
        const correctAnswers = answerRaw.split(',').map(s => s.replace(/\s+/g, '').toLowerCase());
        
        if (correctAnswers.includes(userInput)) {
            clearInterval(timerInterval);
            score += 10;
            document.getElementById('score').innerText = score;
            triggerFeedback('â­• ì •ë‹µì…ë‹ˆë‹¤!', 'var(--success)');
            playSnd(sndCorrect);
            setTimeout(nextQuestion, 800);
        } else { handleWrongProcess('âŒ í‹€ë ¸ì–´ìš”!'); }
    }

    function showPerfect() {
        clearInterval(timerInterval);
        const container = document.getElementById('game-container');
        container.innerHTML = `
            <div class="result-view">
                <div style="font-size: 5rem; margin-bottom: 10px;">ğŸ†</div>
                <h1 style="font-size: 2.5rem; font-weight: 900; color: var(--secondary); margin: 0 0 10px 0;">PERFECT!</h1>
                <p style="font-size: 1.2rem; color: #666; line-height: 1.6; margin-bottom: 30px;">ì¶•í•˜í•©ë‹ˆë‹¤!<br>ëª¨ë“  ë‹¨ì–´ë¥¼ ë§ˆìŠ¤í„°í–ˆìŠµë‹ˆë‹¤.</p>
                <button class="btn-confirm" style="padding: 15px 45px; font-size: 1.2rem; width: auto;" onclick="location.reload()">ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button>
            </div>
        `;
        playSnd(sndSuccess);

        // í­ì£½ì´ í°ìƒ‰ ë°•ìŠ¤(#app) ì•ˆì—ì„œë§Œ í„°ì§€ë„ë¡ ì„¤ì •
        const appBox = document.getElementById('app');
        const end = Date.now() + 3000;

        (function frame() {
            // origin yê°’ì„ 0.7 ì •ë„ë¡œ ì„¤ì •í•˜ì—¬ ë°•ìŠ¤ í•˜ë‹¨ì—ì„œ ì†Ÿêµ¬ì¹˜ê²Œ í•¨
            confetti({
                particleCount: 3,
                angle: 60,
                spread: 55,
                origin: { x: 0.1, y: 0.8 },
                colors: ['#5F56D6', '#FFD93D'],
                useWorker: true
            });
            confetti({
                particleCount: 3,
                angle: 120,
                spread: 55,
                origin: { x: 0.9, y: 0.8 },
                colors: ['#5F56D6', '#FFD93D'],
                useWorker: true
            });
            if (Date.now() < end) requestAnimationFrame(frame);
        }());
    }

    function setCategory(mode, btn) {
        category = mode;
        document.querySelectorAll('.btn-mini').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        nextQuestion();
    }

    function passQuestion() { if (!document.getElementById('user-input').disabled) handleWrongProcess('PASS â©'); }
    function triggerFeedback(text, color) { const area = document.getElementById('feedback-area'); area.innerText = text; area.style.color = color; }

    document.getElementById('sound-toggle').onclick = function() { soundEnabled = !soundEnabled; this.innerText = soundEnabled ? 'ğŸ”Š' : 'ğŸ”ˆ'; };
    document.getElementById('user-input').addEventListener('keypress', (e) => { if(e.key === 'Enter') checkAnswer(); });
</script>
</body>
</html>
